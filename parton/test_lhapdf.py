import unittest
from . import pdf, io
import shutil
import tempfile


lhapdf_CT10 ={
 (-4, 1e-08, 10.0): 12.126009150675591,
 (-4, 1e-08, 56.23413251903491): 41.02476133438564,
 (-4, 1e-08, 316.22776601683796): 88.09606590653031,
 (-4, 1e-08, 1778.2794100389228): 153.7780144766072,
 (-4, 1e-08, 10000.0): 237.50159381331855,
 (-4, 7.498942093324558e-07, 10.0): 4.335460451915329,
 (-4, 7.498942093324558e-07, 56.23413251903491): 12.254992012880091,
 (-4, 7.498942093324558e-07, 316.22776601683796): 23.066720358757788,
 (-4, 7.498942093324558e-07, 1778.2794100389228): 36.273272727566784,
 (-4, 7.498942093324558e-07, 10000.0): 51.40069478365495,
 (-4, 5.623413251903491e-05, 10.0): 1.414605677409382,
 (-4, 5.623413251903491e-05, 56.23413251903491): 3.130963246988818,
 (-4, 5.623413251903491e-05, 316.22776601683796): 4.9789851557660745,
 (-4, 5.623413251903491e-05, 1778.2794100389228): 6.873690044070669,
 (-4, 5.623413251903491e-05, 10000.0): 8.761559269574471,
 (-4, 0.004216965034285823, 10.0): 0.3392520292729965,
 (-4, 0.004216965034285823, 56.23413251903491): 0.5402775654632718,
 (-4, 0.004216965034285823, 316.22776601683796): 0.6880707116873284,
 (-4, 0.004216965034285823, 1778.2794100389228): 0.8020515194422677,
 (-4, 0.004216965034285823, 10000.0): 0.892139648134384,
 (-4, 0.31622776601683794, 10.0): 0.002588510502494359,
 (-4, 0.31622776601683794, 56.23413251903491): 0.002549447011017532,
 (-4, 0.31622776601683794, 316.22776601683796): 0.002313635192150163,
 (-4, 0.31622776601683794, 1778.2794100389228): 0.0020684044457654413,
 (-4, 0.31622776601683794, 10000.0): 0.0018507518649738008,
 (-3, 1e-08, 10.0): 16.756744962359846,
 (-3, 1e-08, 56.23413251903491): 45.391216242724255,
 (-3, 1e-08, 316.22776601683796): 92.27982481303964,
 (-3, 1e-08, 1778.2794100389228): 157.82130933799775,
 (-3, 1e-08, 10000.0): 241.43111563504945,
 (-3, 7.498942093324558e-07, 10.0): 5.7895989791726095,
 (-3, 7.498942093324558e-07, 56.23413251903491): 13.627086559893465,
 (-3, 7.498942093324558e-07, 316.22776601683796): 24.38208662687902,
 (-3, 7.498942093324558e-07, 1778.2794100389228): 37.544982601002665,
 (-3, 7.498942093324558e-07, 10000.0): 52.63701932339524,
 (-3, 5.623413251903491e-05, 10.0): 1.887473467779649,
 (-3, 5.623413251903491e-05, 56.23413251903491): 3.579203838851147,
 (-3, 5.623413251903491e-05, 316.22776601683796): 5.4102249095501165,
 (-3, 5.623413251903491e-05, 1778.2794100389228): 7.29186292469213,
 (-3, 5.623413251903491e-05, 10000.0): 9.169188137598681,
 (-3, 0.004216965034285823, 10.0): 0.5228746551395594,
 (-3, 0.004216965034285823, 56.23413251903491): 0.714124690080171,
 (-3, 0.004216965034285823, 316.22776601683796): 0.8547590504861885,
 (-3, 0.004216965034285823, 1778.2794100389228): 0.962994283665188,
 (-3, 0.004216965034285823, 10000.0): 1.04825839995075,
 (-3, 0.31622776601683794, 10.0): 0.005345303443615897,
 (-3, 0.31622776601683794, 56.23413251903491): 0.004446805556731574,
 (-3, 0.31622776601683794, 316.22776601683796): 0.0037490807510542792,
 (-3, 0.31622776601683794, 1778.2794100389228): 0.0032125670405896553,
 (-3, 0.31622776601683794, 10000.0): 0.002794619101109903,
 (-2, 1e-08, 10.0): 17.605017846766618,
 (-2, 1e-08, 56.23413251903491): 46.191048297236875,
 (-2, 1e-08, 316.22776601683796): 93.04611385178964,
 (-2, 1e-08, 1778.2794100389228): 158.56176695496683,
 (-2, 1e-08, 10000.0): 242.15019914097294,
 (-2, 7.498942093324558e-07, 10.0): 6.055052153385829,
 (-2, 7.498942093324558e-07, 56.23413251903491): 13.877424836344732,
 (-2, 7.498942093324558e-07, 316.22776601683796): 24.621957213835827,
 (-2, 7.498942093324558e-07, 1778.2794100389228): 37.77683241186586,
 (-2, 7.498942093324558e-07, 10000.0): 52.86233026936732,
 (-2, 5.623413251903491e-05, 10.0): 1.9715303564164006,
 (-2, 5.623413251903491e-05, 56.23413251903491): 3.6586617832598414,
 (-2, 5.623413251903491e-05, 316.22776601683796): 5.486527459900575,
 (-2, 5.623413251903491e-05, 1778.2794100389228): 7.365741064546534,
 (-2, 5.623413251903491e-05, 10000.0): 9.241134839331808,
 (-2, 0.004216965034285823, 10.0): 0.5570134353752993,
 (-2, 0.004216965034285823, 56.23413251903491): 0.7477631930570984,
 (-2, 0.004216965034285823, 316.22776601683796): 0.8880559387305795,
 (-2, 0.004216965034285823, 1778.2794100389228): 0.9960158901669028,
 (-2, 0.004216965034285823, 10000.0): 1.0810384205497796,
 (-2, 0.31622776601683794, 10.0): 0.011876087898445954,
 (-2, 0.31622776601683794, 56.23413251903491): 0.00915350813458153,
 (-2, 0.31622776601683794, 316.22776601683796): 0.007410377531394808,
 (-2, 0.31622776601683794, 1778.2794100389228): 0.006186424938281359,
 (-2, 0.31622776601683794, 10000.0): 0.005281385118460772,
 (-1, 1e-08, 10.0): 17.60538047787716,
 (-1, 1e-08, 56.23413251903491): 46.19144584846197,
 (-1, 1e-08, 316.22776601683796): 93.0465822705912,
 (-1, 1e-08, 1778.2794100389228): 158.56172261762887,
 (-1, 1e-08, 10000.0): 242.15095000133647,
 (-1, 7.498942093324558e-07, 10.0): 6.055976149637256,
 (-1, 7.498942093324558e-07, 56.23413251903491): 13.878406857813198,
 (-1, 7.498942093324558e-07, 316.22776601683796): 24.62301282916305,
 (-1, 7.498942093324558e-07, 1778.2794100389228): 37.777934326379324,
 (-1, 7.498942093324558e-07, 10000.0): 52.86354511124354,
 (-1, 5.623413251903491e-05, 10.0): 1.9742784526716286,
 (-1, 5.623413251903491e-05, 56.23413251903491): 3.6617127531796454,
 (-1, 5.623413251903491e-05, 316.22776601683796): 5.489815972869785,
 (-1, 5.623413251903491e-05, 1778.2794100389228): 7.369227816743628,
 (-1, 5.623413251903491e-05, 10000.0): 9.244800231131714,
 (-1, 0.004216965034285823, 10.0): 0.5685067737284695,
 (-1, 0.004216965034285823, 56.23413251903491): 0.7607974122201304,
 (-1, 0.004216965034285823, 316.22776601683796): 0.9021788929879028,
 (-1, 0.004216965034285823, 1778.2794100389228): 1.0109772765737797,
 (-1, 0.004216965034285823, 10000.0): 1.0966774240831234,
 (-1, 0.31622776601683794, 10.0): 0.010373439416445378,
 (-1, 0.31622776601683794, 56.23413251903491): 0.007488490344510958,
 (-1, 0.31622776601683794, 316.22776601683796): 0.005821543054307388,
 (-1, 0.31622776601683794, 1778.2794100389228): 0.004721346325408865,
 (-1, 0.31622776601683794, 10000.0): 0.003942215532844127,
 (0, 1e-08, 10.0): 405.3255637220367,
 (0, 1e-08, 56.23413251903491): 1436.880026381909,
 (0, 1e-08, 316.22776601683796): 3156.596600706753,
 (0, 1e-08, 1778.2794100389228): 5537.111363526038,
 (0, 1e-08, 10000.0): 8521.652709276208,
 (0, 7.498942093324558e-07, 10.0): 139.20380815306046,
 (0, 7.498942093324558e-07, 56.23413251903491): 399.38652484266504,
 (0, 7.498942093324558e-07, 316.22776601683796): 751.8778244490188,
 (0, 7.498942093324558e-07, 1778.2794100389228): 1170.2119470580872,
 (0, 7.498942093324558e-07, 10000.0): 1634.3156982020903,
 (0, 5.623413251903491e-05, 10.0): 42.53967105156836,
 (0, 5.623413251903491e-05, 56.23413251903491): 90.61388339659318,
 (0, 5.623413251903491e-05, 316.22776601683796): 139.3955827757384,
 (0, 5.623413251903491e-05, 1778.2794100389228): 186.30886678289167,
 (0, 5.623413251903491e-05, 10000.0): 230.37005537249675,
 (0, 0.004216965034285823, 10.0): 9.770246611236905,
 (0, 0.004216965034285823, 56.23413251903491): 13.116612420226975,
 (0, 0.004216965034285823, 316.22776601683796): 15.074265241424595,
 (0, 0.004216965034285823, 1778.2794100389228): 16.274307327777525,
 (0, 0.004216965034285823, 10000.0): 17.016579103299154,
 (0, 0.31622776601683794, 10.0): 0.1511807636488401,
 (0, 0.31622776601683794, 56.23413251903491): 0.09514987864524801,
 (0, 0.31622776601683794, 316.22776601683796): 0.06625807729013862,
 (0, 0.31622776601683794, 1778.2794100389228): 0.04919674628311809,
 (0, 0.31622776601683794, 10000.0): 0.038236037093332384,
 (1, 1e-08, 10.0): 17.60538047787716,
 (1, 1e-08, 56.23413251903491): 46.191446527894946,
 (1, 1e-08, 316.22776601683796): 93.0465822705912,
 (1, 1e-08, 1778.2794100389228): 158.56172261762887,
 (1, 1e-08, 10000.0): 242.15095000133647,
 (1, 7.498942093324558e-07, 10.0): 6.056435894038626,
 (1, 7.498942093324558e-07, 56.23413251903491): 13.879081655121778,
 (1, 7.498942093324558e-07, 316.22776601683796): 24.62377099618751,
 (1, 7.498942093324558e-07, 1778.2794100389228): 37.77889253256745,
 (1, 7.498942093324558e-07, 10000.0): 52.86456969015634,
 (1, 5.623413251903491e-05, 10.0): 1.9808741468734439,
 (1, 5.623413251903491e-05, 56.23413251903491): 3.6702685383043385,
 (1, 5.623413251903491e-05, 316.22776601683796): 5.499996546225309,
 (1, 5.623413251903491e-05, 1778.2794100389228): 7.380844869741231,
 (1, 5.623413251903491e-05, 10000.0): 9.257701768571732,
 (1, 0.004216965034285823, 10.0): 0.6455876315279057,
 (1, 0.004216965034285823, 56.23413251903491): 0.849645729138851,
 (1, 0.004216965034285823, 316.22776601683796): 0.9994933659836224,
 (1, 0.004216965034285823, 1778.2794100389228): 1.1149249499399423,
 (1, 0.004216965034285823, 10000.0): 1.2060451257800577,
 (1, 0.31622776601683794, 10.0): 0.16562096068835186,
 (1, 0.31622776601683794, 56.23413251903491): 0.12631109703936957,
 (1, 0.31622776601683794, 316.22776601683796): 0.10254991845260125,
 (1, 0.31622776601683794, 1778.2794100389228): 0.0862699831275305,
 (1, 0.31622776601683794, 10000.0): 0.07433886373595104,
 (2, 1e-08, 10.0): 17.60508047787716,
 (2, 1e-08, 56.23413251903491): 46.19114829723688,
 (2, 1e-08, 316.22776601683796): 93.04631238950503,
 (2, 1e-08, 1778.2794100389228): 158.56172261762887,
 (2, 1e-08, 10000.0): 242.151017194184,
 (2, 7.498942093324558e-07, 10.0): 6.055756222716645,
 (2, 7.498942093324558e-07, 56.23413251903491): 13.87840084017821,
 (2, 7.498942093324558e-07, 316.22776601683796): 24.6231668461724,
 (2, 7.498942093324558e-07, 1778.2794100389228): 37.778282423294385,
 (2, 7.498942093324558e-07, 10000.0): 52.864041745264316,
 (2, 5.623413251903491e-05, 10.0): 1.981945214755691,
 (2, 5.623413251903491e-05, 56.23413251903491): 3.6723532303490014,
 (2, 5.623413251903491e-05, 316.22776601683796): 5.502970529354733,
 (2, 5.623413251903491e-05, 1778.2794100389228): 7.384612901940605,
 (2, 5.623413251903491e-05, 10000.0): 9.26223085528346,
 (2, 0.004216965034285823, 10.0): 0.6876424544066511,
 (2, 0.004216965034285823, 56.23413251903491): 0.9013554694966094,
 (2, 0.004216965034285823, 316.22776601683796): 1.0585024492377975,
 (2, 0.004216965034285823, 1778.2794100389228): 1.179878762750547,
 (2, 0.004216965034285823, 10000.0): 1.2760218101155822,
 (2, 0.31622776601683794, 10.0): 0.42801568253151273,
 (2, 0.31622776601683794, 56.23413251903491): 0.33838274623018844,
 (2, 0.31622776601683794, 316.22776601683796): 0.2816127781774709,
 (2, 0.31622776601683794, 1778.2794100389228): 0.24143415857615186,
 (2, 0.31622776601683794, 10000.0): 0.21124586323352432,
 (3, 1e-08, 10.0): 16.756744962359846,
 (3, 1e-08, 56.23413251903491): 45.391216242724255,
 (3, 1e-08, 316.22776601683796): 92.27982481303964,
 (3, 1e-08, 1778.2794100389228): 157.82130933799775,
 (3, 1e-08, 10000.0): 241.43111563504945,
 (3, 7.498942093324558e-07, 10.0): 5.7895989791726095,
 (3, 7.498942093324558e-07, 56.23413251903491): 13.627086559893465,
 (3, 7.498942093324558e-07, 316.22776601683796): 24.38208662687902,
 (3, 7.498942093324558e-07, 1778.2794100389228): 37.544982601002665,
 (3, 7.498942093324558e-07, 10000.0): 52.63701932339524,
 (3, 5.623413251903491e-05, 10.0): 1.887473467779649,
 (3, 5.623413251903491e-05, 56.23413251903491): 3.579203838851147,
 (3, 5.623413251903491e-05, 316.22776601683796): 5.4102249095501165,
 (3, 5.623413251903491e-05, 1778.2794100389228): 7.29186292469213,
 (3, 5.623413251903491e-05, 10000.0): 9.169188137598681,
 (3, 0.004216965034285823, 10.0): 0.5228746551395594,
 (3, 0.004216965034285823, 56.23413251903491): 0.714124690080171,
 (3, 0.004216965034285823, 316.22776601683796): 0.8547590504861885,
 (3, 0.004216965034285823, 1778.2794100389228): 0.962994283665188,
 (3, 0.004216965034285823, 10000.0): 1.04825839995075,
 (3, 0.31622776601683794, 10.0): 0.005345303443615897,
 (3, 0.31622776601683794, 56.23413251903491): 0.004446805556731574,
 (3, 0.31622776601683794, 316.22776601683796): 0.0037490807510542792,
 (3, 0.31622776601683794, 1778.2794100389228): 0.0032125670405896553,
 (3, 0.31622776601683794, 10000.0): 0.002794619101109903,
 (4, 1e-08, 10.0): 12.126009150675591,
 (4, 1e-08, 56.23413251903491): 41.02476133438564,
 (4, 1e-08, 316.22776601683796): 88.09606590653031,
 (4, 1e-08, 1778.2794100389228): 153.7780144766072,
 (4, 1e-08, 10000.0): 237.50159381331855,
 (4, 7.498942093324558e-07, 10.0): 4.335460451915329,
 (4, 7.498942093324558e-07, 56.23413251903491): 12.254992012880091,
 (4, 7.498942093324558e-07, 316.22776601683796): 23.066720358757788,
 (4, 7.498942093324558e-07, 1778.2794100389228): 36.273272727566784,
 (4, 7.498942093324558e-07, 10000.0): 51.40069478365495,
 (4, 5.623413251903491e-05, 10.0): 1.414605677409382,
 (4, 5.623413251903491e-05, 56.23413251903491): 3.130963246988818,
 (4, 5.623413251903491e-05, 316.22776601683796): 4.9789851557660745,
 (4, 5.623413251903491e-05, 1778.2794100389228): 6.873690044070669,
 (4, 5.623413251903491e-05, 10000.0): 8.761559269574471,
 (4, 0.004216965034285823, 10.0): 0.3392520292729965,
 (4, 0.004216965034285823, 56.23413251903491): 0.5402775654632718,
 (4, 0.004216965034285823, 316.22776601683796): 0.6880707116873284,
 (4, 0.004216965034285823, 1778.2794100389228): 0.8020515194422677,
 (4, 0.004216965034285823, 10000.0): 0.892139648134384,
 (4, 0.31622776601683794, 10.0): 0.002588510502494359,
 (4, 0.31622776601683794, 56.23413251903491): 0.002549447011017532,
 (4, 0.31622776601683794, 316.22776601683796): 0.002313635192150163,
 (4, 0.31622776601683794, 1778.2794100389228): 0.0020684044457654413,
 (4, 0.31622776601683794, 10000.0): 0.0018507518649738008}

lhapdf_MSTW = {
 (1, 0.1, 1): 0.43071,
 (1, 0.1, 3): 0.41700802616344,
 (1, 0.1, 10): 0.39461,
 (4, 0.1, 1): 0,
 (4, 0.1, 3): 0.017505781181267437,
 (4, 0.1, 10): 0.028645,
}

class TestLHAPDF(unittest.TestCase):
    def test_lhapdf_ct10(self):
        dir = tempfile.mkdtemp()
        io.download_pdfset('CT10', dir)
        p = pdf.PDF('CT10', 0, pdfdir=dir)
        for args, lv in lhapdf_CT10.items():
            self.assertAlmostEqual(p.xfxQ(*args) / lv,
                                   1, delta=0.0002,
                                   msg="Failed for {}".format(args))
        shutil.rmtree(dir)

    def test_lhapdf_mstw(self):
        dir = tempfile.mkdtemp()
        io.download_pdfset('MSTW2008nlo90cl', dir)
        p = pdf.PDF('MSTW2008nlo90cl', 0, pdfdir=dir)
        for args, lv in lhapdf_MSTW.items():
            if lv == 0:
                self.assertEqual(p.xfxQ(*args), lv,
                                       msg="Failed for {}".format(args))    
            else:
                self.assertAlmostEqual(p.xfxQ(*args) / lv,
                                       1, delta=0.0002,
                                       msg="Failed for {}".format(args))
        shutil.rmtree(dir)
